<div class="navbar-brand" style="z-index: 1050;position: relative;margin-top:6px; padding-left:30px">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;"
    (click)="goBack()">keyboard_arrow_left</i>
  <!-- Request  -->
  {{ "RequestMsgsPage.RequestDetails" | translate }}
  <!-- <code style="color:#3f87a6; border: 1px solid #cee9f9; font-size:0.8em"> {{cut_support_group_from_request_id(id_request)}} </code> -->
</div>

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">

    <!-- <loading-spinner *ngIf="showSpinner"></loading-spinner>
    *ngIf="!showSpinner" -->

    
    <div>
      <div class="row">
        <div class="col-sm-7 chat-col">
          <div class="card chat-card" style="padding-top:0px; padding-bottom:0px;">
            <div class="row" style="border-bottom: 1px solid #eeeeee; padding-left:25px; padding-right:25px">
              <div class="col-sm-12">



                <div class="two-div-wrapper">
                  <div style="float: left; width: 50%; height: 59px;">
                    <span *ngIf="!showSpinner">
                      <!-- <h4 class="card-title"
                      style="text-transform: none; color: #566787; font-weight:400; margin-top: 18px; margin-bottom: 0px; padding-bottom: 15px;">
                      {{ "RequestMsgsPage.Messages" | translate }}
                    
                    </h4> -->
                      <!-- <div class="contact-details">

                      <i class="material-icons">
                        more_vert
                        </i>
                    </div> -->

                      <!-- -----new REQUESTER -->
                      <span class="requester-avatar-wrapper">
                        <span class="_requester-avatar_as_title" [ngStyle]="{'background-color': fillColour }"
                          [ngClass]="{'requester_fullname-undefined' : !request?.lead?.fullname}">
                          <span style="color: #ffffff"> {{ requester_fullname_initial }} </span>
                        </span>
                        <span *ngIf="REQUESTER_IS_VERIFIED === true" class="tooltipx">
                          <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 26.6 26.6"
                            width="17" height="17" style="position: relative;left: -61px;top: -7px;"
                            xml:space="preserve">
                            <style type="text/css">
                              .st0 {
                                fill: none;
                              }

                              .st1 {
                                fill: #FFFFFF;
                              }

                              .st2 {
                                fill: #18BDF7;
                              }
                            </style>
                            <path class="st0" d="M1.3,1.3h24v24h-24V1.3z" />
                            <path class="st1"
                              d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z" />
                            <path class="st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                                l6.6-6.6l1.4,1.4L11.3,18.3z" />
                          </svg>
                          <span class="tooltiptext"> {{ "VisitorsPage.AuthenticatedUser" | translate }} </span>
                        </span>
                        <div class="requester-status-icon-avatar_as_title"
                          [ngClass]="{'requester_is_online' : REQUESTER_IS_ONLINE}">
                        </div>

                      </span>

                      <!-- <span style="color:#394f5a;"> {{ "RequestMsgsPage.RequesterName" | translate }}: </span>  -->
                      <div class="contact_info">

                        <span [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}"
                          style="margin-top: 13px; display: block; font-size: 18px;">
                          <!-- {{ requester_fullname }} -->
                          {{request?.lead?.fullname}}
                        </span>
                        <span *ngIf="!request?.lead?.fullname"
                          [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}" style="margin-left: 2px;">
                          n.a.
                        </span>

                        <span style="position: relative; top: -4px;"
                          [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}">
                          <i class="material-icons"
                            style="vertical-align: middle; color: #7695a5;font-size:12px; position: relative; top: 1px;">
                            email
                          </i>
                          <span style="position: relative;top: 1px;">
                            <!-- <span
                      style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                      {{ "RequestMsgsPage.ChatFormUserEmail" | translate }}
                    </span> -->
                            <a style="font-size: 13px;" target="_blank" *ngIf="request?.lead?.email"
                              href="mailto:{{request?.lead?.email}}">
                              {{request?.lead?.email}}
                            </a>
                            <a *ngIf="!request?.lead?.email" style="color:#7695a5;font-size: 13px;">n.a.</a>

                            <span *ngIf="NODEJS_REQUEST_CNTCT_FOUND">
                              <span (click)="goToContactDetails()" class="" style="margin-left: 30px;  color: #03a5e8;
                          font-size: 12px;
                          font-weight: 400;cursor:pointer">
                                {{ 'ViewDetails' | translate}}
                              </span>
                            </span>
                          </span>
                        </span>
                      </div>
                      <!-- -----new REQUESTER -->

                    </span>
                  </div>

                  <div style="float: right; width: 50%; ">

                    <!-- -----------------============= ACTIONS DROPDOWN MENU =============----------------- -->
                    <div class="dropdown pull-right">
                      <a href="#" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                        style="padding:6px 15px; margin-top: 15px">
                        {{ 'VisitorsPage.Actions' | translate }}
                        <b class="caret"></b>
                      </a>
                      <ul class="dropdown-menu">
                        <li [ngClass]="{'disable-dropdown-menu-btn' : request?.status == 1000}">
                          <a (click)='openArchiveRequestModal(request?.request_id)'
                            style="padding-left: 15px; padding-right: 15px;">
                            <i class="material-icons" style="padding-right: 5px;">close</i>
                            <span style="position: relative; top: 1px; cursor:pointer">
                              {{ 'RequestMsgsPage.CloseTheRequest' | translate }}
                            </span>
                          </a>
                        </li>
                        <li class="divider"></li>
                        <!-- [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_AGENT === true}" -->
                        <li>
                          <a (click)='openSelectUsersModal(action = "reassign")'
                            style="padding-left: 15px; padding-right: 15px;">
                            <i class="material-icons" style="padding-right: 5px;">swap_horiz</i>
                            <span style="position: relative; top: 1px; cursor:pointer">
                              {{ 'VisitorsPage.ReassignRequest' | translate }}
                            </span>
                          </a>
                        </li>
                        <!-- [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_AGENT === true}" -->
                        <li>
                          <a (click)='openSelectUsersModal(action = "invite")'
                            style="padding-left: 15px; padding-right: 15px;">
                            <i class="material-icons" style="padding-right: 5px;">person_add</i>
                            <span style="position: relative; top: 1px; cursor:pointer">
                              {{ 'VisitorsPage.AddAgent' | translate }}
                            </span>
                          </a>
                        </li>

                        <li class="divider"></li>
                        <li [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_JOINED === false}">

                          <a (click)='openleaveChatModal()' style="padding-left: 15px; padding-right: 15px;">
                            <i class="material-icons" style="padding-right: 5px;">exit_to_app</i>
                            <span style="position: relative; top: 1px; cursor:pointer">
                              {{ 'VisitorsPage.LeaveChat' | translate }}
                            </span>
                          </a>
                        </li>

                        <li class="divider"></li>
                        <li>
                          <a (click)='openTranscript()' style="padding-left: 15px; padding-right: 15px;">
                            <i class="material-icons" style="padding-right: 5px;">open_in_new</i>
                            <span style="position: relative; top: 1px; cursor:pointer">

                              {{ 'VisitorsPage.Open' | translate }} transcript
                            </span>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- <loading-spinner *ngIf="showSpinner"></loading-spinner> -->

            <div *ngIf="showSpinner" class="stretchspinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>

            <div #scrollMe class="card-content"
              style="height: 500px; overflow-y: auto; padding: 0px; padding-left:25px; padding-right:25px "
              (scroll)="onScroll($event)">


              <div *ngIf="!showSpinner" class="chat-body" style="vertical-align:baseline;">

                <!-- style="padding-bottom: 3px;" class="answer left" -->
                <div *ngFor="let message of messagesList">

                  <div class="parent">
                    <div [ngClass]="{'child' : requester_id !== message.sender}">

                      <div class="speech-wrapper">

                        <!-- ////// REQUESTER -->
                        <div *ngIf="requester_id === message.sender" class="bubble">
                          <div class="avatar"
                            style="  width: 35px; height: 35px; position: absolute; left: -50px; bottom: 36px;">
                            <div class="requester-avatar-wrapper"
                              style="display: block;border-radius: 50%; height: 100%; margin-top: 35px;"
                              [ngStyle]="{'background-color': fillColour }">
                              <!-- position: absolute; top:42px; margin-left:10px; color: #fff; text-transform: uppercase -->
                              <span class="_requester-avatar-inchat">
                                <!-- {{ messageSenderInitialLetter( message.sender_fullname )}} -->
                                {{ requester_fullname_initial }}

                              </span>
                            </div>
                          </div>

                          <div class="txt">
                            <p class="name" [ngStyle]="{'color': fillColour }">{{ message.senderFullname }}
                              <!-- margin-right: -45px; -->
                              <span style="float:right; cursor:pointer; color: #00bcf8; text-decoration: underline;"
                                (click)="openRightSideBar(message?.text)">
                                <!-- Addestra -->
                                {{ 'Train' | translate }}

                              </span>
                            </p>
                            <p class="message" style="word-break: break-all;">
                              {{ message?.text }}
                            </p>
                            <span class="timestamp"> {{ message?.createdAt | date: 'd/M/y HH:mm:ss'}} </span>
                          </div>
                          <div class="bubble-arrow"></div>
                        </div>
                        <!-- ////////////////// Speech Bubble alternative ////////////////// -->
                        <div *ngIf="requester_id !== message.sender" class="bubble alt">

                          <div class="avatar"
                            style="width: 35px; height: 35px; position: absolute; left: 254px; bottom: 36px;">
                            <div
                              style="display: block;border-radius: 50%; height: 100%; margin-top: 35px; background-color: #fff; border:1px solid #ebebeb;">

                              <!-- USE CASE: human -->
                              <!-- <span *ngIf="message?.sender !== 'system' && message?.senderFullname !== 'Bot'" style="position: absolute; top:43px; margin-left:13px;"> -->
                              <span *ngIf="message?.sender !== 'system' && message?.sender.indexOf('bot_') === -1"
                                style="position: absolute; top:43px; margin-left:13px;">
                                <!-- {{ messageSenderInitialLetter( message?.senderFullname )}} -->
                                <!-- {{ message?.sender }}{{  message?.senderFullname }} -->
                                <img
                                  style="vertical-align: middle; width: 36px; height: 36px; border-radius: 50%; border: 1px solid #eee; margin-top: 1px; margin-bottom: 1px;position: relative;top: -9px; left: -14px;"
                                  class="user-img"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{message?.sender}}%2Fphoto.jpg?alt=media"
                                  onerror="this.src='assets/img/no_image_user.png'" />
                              </span>

                              <!-- USE CASE: bot -->
                              <!-- <span *ngIf="message?.senderFullname === 'Bot'" style="position: absolute; top:43px; margin-left:13px;"> -->
                              <span *ngIf="message?.sender.indexOf('bot_') !== -1"
                                style="position: absolute; top:43px; margin-left:13px;">
                                <img
                                  style="vertical-align: middle; width: 36px; height: 36px; border-radius: 50%; border: 1px solid #eee; position:relative;top: -9px;left: -14px;"
                                  class="user-img"
                                  src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{message?.sender | slice:4 }}%2Fphoto.jpg?alt=media"
                                  onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />
                              </span>

                              <!-- USE CASE: system but with name Bot -->
                              <span *ngIf="message?.sender === 'system' && message?.senderFullname === 'Bot'"
                                style="position: absolute; top:43px; margin-left:13px;color: #999999;">
                                <!-- {{ message?.sender }}{{  message?.senderFullname }} -->
                                <img
                                  style="vertical-align: middle; width: 36px; height: 36px; border-radius: 50%; border: 1px solid #eee; position:relative;top: -9px;left: -14px;"
                                  class="user-img" src="assets/img/bot_image_as_human.jpg"
                                  onerror="this.src='assets/img/no_image_user.png'" />
                              </span>

                              <!-- USE CASE: system -->
                              <span *ngIf="message?.sender === 'system' && message?.senderFullname !== 'Bot'"
                                style="position: absolute; top:43px; margin-left:13px;color: #999999;">
                                <!-- {{ message?.sender }}{{  message?.senderFullname }} -->
                                <i class="material-icons"
                                  style="position: relative;left: -9px;top: -3px;font-size:26px">
                                  code
                                </i>
                              </span>


                            </div>
                          </div>
                          <div class="txt">
                            <p class="name alt">
                              {{ message.senderFullname }}
                              <!-- +353 87 1234 567<span> ~ John</span> -->
                            </p>
                            <p class="message" style="word-break: break-all;">{{ message.text }}</p>
                            <span class="timestamp"> {{ message.createdAt | date: 'd/M/y HH:mm:ss'}}</span>
                          </div>
                          <div class="bubble-arrow alt"></div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

              <a id="fixed-button" class="button" [ngStyle]="{'display':displayBtnScrollToBottom }"
                (click)="scrollToBottom()">
                <span class="icon is-small">
                  <i class="fa fa-chevron-down"></i>
                </span>
              </a>

            </div>

            <div class="card-footer" style="text-align: center; margin-bottom: 0px;padding-top: 2px; margin:auto">
              <div class="stats" style="width: 100%; min-height: 69px;">

                <!-- -------------------================== start new three btn ==================------------------- -->
                <div class="row" style="width: 100%">

                  <!-- -------------------====== CLOSE CHAT - MOVED IN DROPDOWN ======------------------- -->
                  <!-- <div class="col-xs-4 col-sm-4 col-md-4" style="padding-right:5px">
                    <button type="button" class="btn btn-danger btn-block tooltipx"
                      (click)='openArchiveRequestModal(request?.request_id)' style="vertical-align: middle; padding-left: 0px;padding-right: 0px;" 
                      [disabled]="request?.status == 1000">
                        {{ 'RequestMsgsPage.Close' | translate }}
                      <span class="tooltiptext">{{ 'RequestMsgsPage.CloseTheRequest' | translate }}</span>
                    </button>
                  </div> -->

                  <!-- ------------============ BTNS SWITCH: OPEN THE CHAT, ENTER, LOADING, ERROR ============------------ -->
                  <!-- [disabled]="request?.status == 1000" -->
                  <div class="col-xs-12" style="padding-left:5px; padding-right:5px">

                    <div class="centered-buttons" style="width: 100%; padding: 0px 35px;">
                      <span
                        *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                        <button #openChatBtn (click)="openChatInNewWindow()"
                          class="btn btn-primary btn-block open_the_chat_btn" role="button"
                          style="padding-left: 0px; padding-right: 0px"
                          [ngClass]="{'disable_open_the_chat_btn' : request?.status == 1000}">

                          <i class="material-icons"
                            style="vertical-align: middle;  top:0px !important; padding-bottom: 2px;">open_in_new</i>
                          <span style="vertical-align: middle"> {{ 'RequestMsgsPage.OpenTheChat' | translate }}</span>
                        </button>
                      </span>

                      <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === false 
                          && IS_CURRENT_USER_JOINED === false 
                          && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false 
                          && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                        <button class="btn btn-primary btn-block" (click)="onJoinHandled()"
                          style="padding-left: 0px;padding-right: 0px;" [disabled]="request?.status == 1000">
                          {{ 'RequestMsgsPage.Enter' | translate }}
                        </button>
                      </span>

                      <span *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
                          && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
                          && JOIN_TO_GROUP_HAS_ERROR === false">
                        <button class="btn btn-default btn-block" style="padding-left: 0px;padding-right: 0px;"
                          btn-block>
                          <i class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i>
                          {{ 'RequestMsgsPage.Loading' | translate }}
                        </button>
                      </span>

                      <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">
                        <button class="btn btn-danger btn-block" disabled style="padding-left: 0px;padding-right: 0px;">
                          {{ 'RequestMsgsPage.Error' | translate }}
                        </button>
                      </span>
                    </div>

                    <!--  -------------------====== BTN REASSIGN REQUETS - MOVED IN DROPDOWN ======----------------- -->
                    <!-- <div class="col-xs-4 col-sm-4 col-md-4" style="padding-left:5px;">
                      <button type="button" class="btn btn-warning btn-block tooltipx"
                          (click)='openSelectUsersModal()' 
                          style="vertical-align: middle; padding-left: 0px;padding-right: 0px;" 
                          [disabled]="request?.status == 1000">
                          {{ 'VisitorsPage.Reassign' | translate }}
                        
                        <span class="tooltiptext" style="text-transform:none">
                          {{ 'VisitorsPage.ReassignRequest' | translate }}
                        </span>
                      </button>
                    </div> -->
                  </div>
                </div> <!-- ./end ROW -->

              </div>

            </div>
          </div> <!-- ./ card   -->
        </div> <!-- ./ col-md-7 -->

        <!-- 
        // -----------------------------------------------------------------------------
        // @ RIGHT SIDEBAR
        // ----------------------------------------------------------------------------- -->
        <div class="col-sm-5 right-col">

          <div class="card right-card" style="padding-top:5px; padding-bottom:5px;margin-bottom: 10px;">

            <div *ngIf="showSpinner" class="stretchspinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>


            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;min-height: 510px;">
              <div *ngIf="!showSpinner" class="content-wrap">
                <div style="margin-bottom: 0px; min-height: 50px;border-bottom: 1px solid #eeeeee;">
                  <!-- 
                // -------------------------------------
                // IF IS A CLOSED REQUEST
                // ------------------------------------- -->
                  <span *ngIf="request?.status == 1000 && !request?.subject">
                    <svg viewBox="0 0 58.1 53.9" style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .st0-chat-closed {
                          fill: none;
                          stroke: #999999;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .st1-chat-closed {
                          fill: #999999;
                        }
                      </style>
                      <path class="st0-chat-closed" d="M30.1,2.6c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C8.9,41.4,7.9,47.2,5.1,50c0,0,8.6-1.2,14.4-4.7
                      c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.9,2.6,30.1,2.6z" />
                      <path class="st1-chat-closed" d="M30.4,13.8c-6.3,0-11.4,5-11.4,11.2h-3.8l4.9,4.9l0.1,0.2l5.1-5h-3.8c0-4.8,4-8.7,8.9-8.7s8.9,3.9,8.9,8.7
                      s-4,8.7-8.9,8.7c-2.5,0-4.7-1-6.3-2.6L22.3,33c2.1,2,4.9,3.3,8.1,3.3c6.3,0,11.4-5,11.4-11.2S36.7,13.8,30.4,13.8z M29.1,20v6.2
                      l5.4,3.2l0.9-1.5L31,25.3V20H29.1z" />
                    </svg>
                    <span class="request-category" style="position:relative;top: -11px; color: #999999">
                      {{ "RequestMsgsPage.RequestClosed" | translate }}
                    </span>
                  </span>

                  <!-- 
                // -------------------------------------
                // IF IS AN INTERNAL CLOSED REQUEST
                // ------------------------------------- -->
                  <span *ngIf="request?.status == 1000 && request?.subject">
                    <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                      style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .closed_Internal_st0 {
                          fill: none;
                          stroke: #999999;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .closed_Internal_st1 {
                          fill: #999999;
                        }
                      </style>
                      <path class="closed_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
           C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                      <path class="closed_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
           c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
           C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
           c0.5,0,0.9-0.5,0.9-1.1V22z" />
                    </svg>
                    <span class="request-category" style="position:relative;top: -11px; color: #999999">
                      {{ "RequestMsgsPage.InternalRequestClosed" | translate }}
                    </span>
                  </span>

                  <!-- 
                // -------------------------------------
                // IF IS AN UNSERVED REQUEST
                // ------------------------------------- -->
                  <span *ngIf="request?.status === 100 && !request?.subject">
                    <svg viewBox="0 0 58.1 53.9" style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .st0-unserved {
                          fill: none;
                          stroke: #ED4537;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .st1-unserved {
                          fill: #ED4537;
                        }
                      </style>
                      <path class="st0-unserved" d="M30.5,3.3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                        c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3.3,30.5,3.3z" />
                      <g>
                        <path class="st1-unserved"
                          d="M30.6,38.9c-1.7,0-3.1-1.4-3.1-3c0-1.7,1.4-3,3.1-3c1.7,0,3.1,1.4,3.1,3C33.6,37.6,32.3,38.9,30.6,38.9z" />
                        <path class="st1-unserved" d="M34.8,18l-1.5,10c-0.2,1.5-1.6,2.5-3.1,2.3c-1.2-0.2-2.1-1.1-2.3-2.2l-1.6-10c-0.4-2.3,1.2-4.5,3.6-4.9
                          c2.4-0.4,4.6,1.2,5,3.5C34.9,17.1,34.9,17.6,34.8,18z" />
                      </g>
                    </svg>
                    <span class="request-category" style="position: relative;top:-11px; color: #f44336">
                      {{ "RequestMsgsPage.RequestUnserved" | translate }}
                    </span>
                  </span>

                  <!-- 
                // -------------------------------------
                // IF IS AN INTERNAL UNSERVED REQUEST 
                // ------------------------------------- -->
                  <span *ngIf="request?.status === 100 && request?.subject">
                    <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                      style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .unserved_Internal_st0 {
                          fill: none;
                          stroke: #ED4537;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .unserved_Internal_st1 {
                          fill: #ED4537;
                        }
                      </style>
                      <path class="unserved_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
           C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                      <path class="unserved_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
           c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
           C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
           c0.5,0,0.9-0.5,0.9-1.1V22z" />
                    </svg>

                    <span class="request-category" style="position:relative;top: -11px; color: #999999">
                      {{ "RequestMsgsPage.InternalRequestUnserved" | translate }}
                    </span>
                  </span>



                  <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                  <!-- <span *ngIf="request?.status == 200 && request?.currentUserIsJoined === true"> -->
                  <span *ngIf="request?.status == 200 && IS_CURRENT_USER_JOINED === true && !request?.subject">
                    <svg viewBox="0 0 58.1 53.9" style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .st0-served-by-cu {
                          fill: none;
                          stroke: #4DAF4F;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .st1-served-by-cu {
                          fill: #4DAF4F;
                        }
                      </style>
                      <path class="st0-served-by-cu" d="M29.8,3.7c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                      c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S43.6,3.7,29.8,3.7z" />
                      <g id="XMLID_146_">
                        <path id="XMLID_158_" class="st1-served-by-cu" d="M25.8,36.5l-8.4-7.4c-1.1-0.9-1.1-2.4,0-3.3c1.1-0.9,2.8-0.9,3.8,0l4.6,4.1l12.6-10.9
                        c1.1-0.9,2.8-0.9,3.8,0c1,0.9,1,2.4,0,3.3L25.8,36.5z" />
                      </g>
                    </svg>

                    <span class="request-category" style="position:relative;top:-11px; color: #4CAF50">
                      {{ "RequestMsgsPage.RequestServedBy" | translate }}
                    </span>
                  </span>

                  <!-- IF IS A INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                  <!-- <span *ngIf="request?.status == 200 && request?.currentUserIsJoined === true"> -->
                  <span *ngIf="request?.status == 200 && IS_CURRENT_USER_JOINED === true && request?.subject">
                    <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                      style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .served_bycu_Internal_st0 {
                          fill: none;
                          stroke: #4DAF4F;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .served_bycu_Internal_st1 {
                          fill: #4DAF4F;
                        }
                      </style>
                      <path class="served_bycu_Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
           C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                      <path class="served_bycu_Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
           c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
           C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
           c0.5,0,0.9-0.5,0.9-1.1V22z" />
                    </svg>

                    <span class="request-category" style="position:relative;top:-11px; color: #4CAF50">
                      {{ "RequestMsgsPage.InternalRequestServedBy" | translate }}
                    </span>
                  </span>


                  <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                  <!-- <span *ngIf="request?.status == 200 && !request?.currentUserIsJoined"> -->
                  <span *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && !request?.subject">

                    <svg viewBox="0 0 58.1 53.9" style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .st0-served {
                          fill: none;
                          stroke: #05BDD4;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .st1-served {
                          fill: #05BDD4;
                        }
                      </style>
                      <g>
                        <path class="st0-served" d="M30.5,3c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3c-0.3,4.1-1.3,9.9-4.1,12.7c0,0,8.6-1.2,14.4-4.7
                        c3.2,1.4,6.8,2.1,10.6,2.1c13.8,0,25-10,25-22.4S44.3,3,30.5,3z" />
                        <g>
                          <circle class="st1-served" cx="17.5" cy="26.7" r="3" />
                          <circle class="st1-served" cx="30.5" cy="26.7" r="3" />
                          <circle class="st1-served" cx="43.5" cy="26.7" r="3" />
                        </g>
                      </g>
                    </svg>

                    <span class="request-category" style="position:relative;top: -11px; color: #00bcd4;">

                      {{ "RequestMsgsPage.RequestServedBy" | translate }}

                    </span>
                  </span>

                  <!-- IF IS AN INTERNAL SERVED REQUEST AND BETWEEN THE MEMBERS THERE ISN'T THE CURRENT USER -->
                  <!-- <span *ngIf="request?.status == 200 && !request?.currentUserIsJoined"> -->
                  <span *ngIf="request?.status == 200 && !IS_CURRENT_USER_JOINED && request?.subject">

                    <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.1 53.9"
                      style="width: 40px" xml:space="preserve">
                      <style type="text/css">
                        .served__Internal_st0 {
                          fill: none;
                          stroke: #05BDD4;
                          stroke-width: 2;
                          stroke-miterlimit: 10;
                        }

                        .served__Internal_st1 {
                          fill: #05BDD4;
                        }
                      </style>
                      <path class="served__Internal_st0" d="M29,3.2c-13.8,0-25,10-25,22.4c0,4.6,1.5,8.8,4.1,12.3C7.8,42,6.8,47.9,4,50.7c0,0,8.6-1.2,14.4-4.7
           C21.6,47.4,25.2,48,29,48c13.8,0,25-10,25-22.4S42.8,3.2,29,3.2z" />
                      <path class="served__Internal_st1" d="M22.8,22.4h12.5v9.1H22.8V22.4z M38.5,27c0,1.3,0.8,2.3,1.9,2.3v4.5c0,1.3-0.8,2.3-1.9,2.3H19.6
           c-1,0-1.9-1-1.9-2.3v-4.5c1,0,1.9-1,1.9-2.3s-0.8-2.3-1.9-2.3v-4.5c0-1.3,0.8-2.3,1.9-2.3h18.8c1,0,1.9,1,1.9,2.3v4.5
           C39.3,24.7,38.5,25.7,38.5,27z M36.6,22c0-0.6-0.4-1.1-0.9-1.1H22.5c-0.5,0-0.9,0.5-0.9,1.1v9.8c0,0.6,0.4,1.1,0.9,1.1h13.2
           c0.5,0,0.9-0.5,0.9-1.1V22z" />
                    </svg>

                    <span class="request-category" style="position:relative;top: -11px; color: #00bcd4;">

                      {{ "RequestMsgsPage.InternalRequestServedBy" | translate }}

                    </span>
                  </span>


                  <!-- <div class="id__request"
                  style="color: #7695a5 !important; font-size: 10px; display: block; margin-left: 43px; margin-top: -26px;font-weight: 400;">
                  <span style="color:#394f5a;"> id: </span>
                  {{ id_request }}
                </div> -->

                </div>

                <!-- <span class="row-body">
              <span style="color:#394f5a;"> id: </span> {{ id_request }}
            </span> -->

                <div *ngIf="request?.subject" class="row" style="margin-top:5px">
                  <div class="col-sm-12">
                    <p class="" style="margin-bottom: 1px;">
                      <span
                        style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;margin-left: 4px;">
                        {{ "RequestMsgsPage.Subject" | translate }}
                      </span>
                      <span style="color: #7695a5; font-weight: 500; font-size: 12px;">
                        {{ request?.subject}}
                      </span>

                    </p>
                  </div>
                </div>

                <div class="row" style="margin-top:5px">
                  <!-- border-top: 1px solid #e1eef4;" -->
                  <!-- border-bottom: 1px solid #e1eef4; -->
                  <div class="col-sm-12">
                    <p class="" style="margin-bottom: 1px;margin-top: 6px;">
                      <i class="material-icons"
                        style="vertical-align: middle; color: #394f5a;font-size:14px;  margin-right: 3px;">calendar_today</i>
                      <span style="position: relative;top: 1px;">
                        <span
                          style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                          {{ "RequestMsgsPage.Created" | translate }}
                        </span>

                        <span style="color: #7695a5; font-weight: 500; font-size: 12px;">
                          {{ request?.createdAt | amTimeAgo }} ({{ request?.createdAt | date: 'd/M/y HH:mm:ss' }})
                        </span>
                      </span>
                    </p>

                    <!-- <span class="row-body">
                  {{ request?.createdAt | amTimeAgo }} ({{ request?.createdAt | date: 'd/M/y HH:mm:ss' }})
                </span> -->

                  </div>
                </div>

                <div class="row" style="margin-top:5px">
                  <!-- border-top: 1px solid #e1eef4;" -->
                  <div class="col-sm-12">
                    <p class="" style="margin-bottom: 0px;">
                      <i class="material-icons"
                        style="vertical-align: middle; color: #394f5a;font-size:16px">outlined_flag</i>
                      <span style="position: relative;top: 1px;">
                        <span
                          style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                          {{ "Language" | translate }}</span>

                        <span style="color: #7695a5; font-weight: 500; font-size: 12px;">
                          {{ request?.language }}
                        </span>
                      </span>
                    </p>

                  </div>
                </div>

                <div class="row" style="margin-top:5px">
                  <div class="col-sm-12">
                    <p class="" style="margin-bottom: 0px;">
                      <i class="material-icons" style="vertical-align: middle; color: #394f5a;font-size:16px">code</i>
                      <span style="position: relative;top: 1px;">
                        <span
                          style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                          {{ "RequestMsgsPage.RequestId" | translate }}</span>
                        <span style="color: #7695a5; font-weight: 500; font-size: 12px;">
                          {{ id_request }}
                        </span>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="row" style="margin-top:5px">
                  <div class="col-sm-12">
                    <p class="" style="margin-bottom: 0px;">
                      <i class="material-icons"
                        style="vertical-align: middle; color: #394f5a;font-size:16px">account_balance</i>
                      <span style="position: relative;top: 1px;">
                        <span
                          style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                          {{ "Department" | translate }}
                        </span>
                        <span style="color: #7695a5; font-weight: 500; font-size: 12px;">


                          <span *ngIf="request?.department">
                            {{request?.department?.name}}
                          </span>
                          <span *ngIf="!request?.department" style="text-transform: lowercase;">
                            {{'DepartmentsPage.NoDept' | translate}}
                          </span>

                        </span>
                      </span>
                    </p>
                  </div>
                </div>





                <!-- 
              // ------------------------------------------------------
              // Source page
              // ------------------------------------------------------ -->
                <div class="row" style="margin-top:5px">
                  <div class="col-sm-12">
                    <p class="" style="">
                      <span style="position: relative;top: 1px;">
                        <div class="row">
                          <div class="col-sm-10">
                            <i class="material-icons"
                              style="vertical-align: middle; color: #394f5a;font-size:16px">language</i>
                            <span
                              style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                              {{ "RequestMsgsPage.SourcePage" | translate }}</span>
                            <span style=" font-weight: 500; font-size: 12px;">
                              <span *ngIf="showAllSourcePageString" style="word-wrap: break-word;">
                                <a href="{{request?.sourcePage}}" target="_blank">{{request?.sourcePage}}</a>
                              </span>
                              <span *ngIf="!showAllSourcePageString">
                                <a href="{{request?.sourcePage}}" target="_blank">{{sourcePageCutted}}</a>
                              </span>
                            </span>
                          </div>

                          <div class="col-sm-2" style="text-align: right;">
                            <i id="source_page_arrow_down" class="material-icons rotate"
                              style="cursor: pointer; color: #039be5; font-size:18px;position:relative; top:5px"
                              (click)="toggleShowAllSourcePageString()">
                              keyboard_arrow_down
                            </i>
                          </div>
                        </div>
                      </span>
                    </p>
                  </div>
                </div>


                <!-- </div>
          </div> -->
                <!-- end card icon -->



                <!-- 
          // -----------------------------------------------------------------------------
          // Agents
          // ----------------------------------------------------------------------------- -->
                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->

                <div class="row" style="">
                  <div class="col-sm-12" style="border-bottom: 1px solid #dadde1; border-top: 1px solid #dadde1;">
                    <p class="row-header" style="">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "RequestMsgsPage.Agents" | translate }}
                      </span>
                    </p>

                    <div class="served_by">
                      <span *ngIf="agents_array?.length === 0" class="row-body">
                        <div class="ws_request_msgs___served_by"></div>
                        <span class="ws_request_msgs___served_by_no_agent" style="position: relative;top: 4px;">
                          {{ "RequestMsgsPage.NoAgent" | translate }}
                        </span>
                      </span>
                      <div *ngFor="let agent of agents_array" class="row-body">

                        <span (click)="goToMemberProfile( agent?._id )" style="cursor:pointer">
                          <img *ngIf="agent.isBot === false"
                            style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%; border: 1px solid #eee; margin-right: 3px;"
                            class="user-img"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/no_image_user.png'" />

                          <img *ngIf="agent.isBot === true"
                            style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%; border: 1px solid #eee; margin-right: 3px;"
                            class="user-img"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{agent?._id | slice:4 }}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />

                          <span [ngClass]="{'current_user_is_agent' : agent?._id === currentUserID}"
                            style="font-size:12px; font-weight: 400">
                            {{agent?.firstname}} {{agent?.lastname}}

                            <span *ngIf="agent.isBot === true">(bot) </span>
                          </span>
                        </span>

                        <span *ngIf="agent.isBot === false">
                          <span class="White__Tooltip">
                            <i class="material-icons chat-with-agent-ws-request-detail"
                              (click)="chatWithAgent( agent?._id, agent?.firstname, agent?.lastname)">
                              chat
                            </i>
                            <span class="White__Tooltiptext"
                              style="font-size: 12px; white-space: nowrap;font-weight: 100;">
                              {{"ChatWith" | translate }}:
                              <span style="display:block"> {{agent?.firstname}} {{agent?.lastname }} </span>
                            </span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- </div>
          </div> -->


                <!-- 
          // -----------------------------------------------------------------------------
          // Tags
          // ----------------------------------------------------------------------------- -->
                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->
                <div class="row" style="">
                  <div class="col-sm-12" style="border-bottom: 1px solid #dadde1;">
                    <p class="row-header">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "Tags.Tags" | translate }}
                      </span>
                    </p>
                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">
                      <div class="tags-container">
                        <div class="tag" *ngFor="let tag of request?.tags" role="button">
                          <div (click)="removeTag(tag)">
                            <!-- [style.background-color]="stringToColour(tag)" -->
                            <!-- margin-right: 2px; -->
                            <div class="icon-container" style="display: inline-block;">
                              <svg style="width: 13px; height: auto;position:absolute;margin-top: 6px;"
                                aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag"
                                class="svg-inline--fa-tag-icon fa-tag fa-w-16" role="img"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">

                                <path [ngStyle]="{'fill':tag.color}" class="tag_icon_in_ws_msgs"
                                  d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z">
                                </path>
                              </svg>

                              <span class="tag-delete">
                                <i class="material-icons delete_note_icon" style="font-size: 16px;"> close </i>
                              </span>

                            </div>

                            <!-- <div class="tag-color" [style.background-color]="tag.color">
                            <span class="tag-delete">
                              <i class="material-icons" style="font-size: 16px;"> close </i>
                            </span>
                          </div> -->
                            {{ tag.tag}}
                          </div>
                        </div>
                      </div>
                      <!-- btn-white-custom-round  -->
                      <button class="btn btn-xs btn-primary ws_msgs_small_btn add_tag_btn"
                        style="margin-top: 4px;  margin-bottom: 6px;" (click)="toggleAddTagInputAndGetTags()">
                        <i *ngIf="diplayAddTagInput === false" class="material-icons"
                          style="font-size: 15px;">add_circle</i>
                        <i *ngIf="diplayAddTagInput === true" class="material-icons"
                          style="font-size: 15px;">remove_circle</i>

                        {{ 'Tags.AddTags' | translate}}

                      </button>
                      <!-- btn-white-no-border -->
                      <!-- <button class="btn btn-xs btn-white-custom-round" style="margin-left:8px;margin-top: 4px;"
                      (click)="goToTags()">
                      <i class="material-icons">edit</i>
                      {{ 'Tags.ManageTags' | translate}}
                    </button> -->

                      <div *ngIf="CURRENT_USER_ROLE !== 'agent'"   (click)="goToTags()" class="manage_tags">
                        {{ 'Tags.ManageTags' | translate}}
                      </div>
                    </div>

                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">
                      <div *ngIf="diplayAddTagInput === true" class="tag-input-wrap" style="margin-bottom: 6px;">
                        <!-- <input (keyup.enter)="addTag()" [(ngModel)]="tag" type="text" id="tag" class="input" 
                        placeholder="{{ 'Tags.TypeALabelAndPressEnter' | translate}}"> -->


                        <!-- [closeOnSelect]="true" -->
                        <!--   -->
                        <!--  -->
                        <!-- [closeOnSelect]="true" 
                        [clearSearchOnAdd]="true"
                        bindLabel="tag"
                        [items]="tagsList"
                        placeholder="{{ 'Tags.TypeALabelAndPressEnter' | translate}}" -->
                        <!-- <span [style.background-color]="tag.color"  style="height: 16px;width: 16px;"> </span> -->
                        <!--  -->
                        <!-- <ng-select [(ngModel)]="tag" (change)="addTag()" [clearSearchOnAdd]="true" [clearable]="false"
                        placeholder="{{ 'Tags.TypeALabelAndPressEnter' | translate}}">

                        <ng-option *ngFor="let tag of tagsList" [value]="tag">
                          <ng-template>
                            Custom footer
                          </ng-template>
                  
                                             {{ tag.tag }}
                                        
                        </ng-option>

                      </ng-select> -->
                        <!-- 'Tags.TypeALabelAndPressEnter' | translate -->
                        <!-- // ------------------------------------------------------ -->
                        <ng-select (change)="addTag()" [items]="tagsList" bindLabel="tag" bindValue="_id"
                          [clearable]="false" [clearSearchOnAdd]="true" placeholder="{{ typeALabelAndPressEnter}}"
                          [(ngModel)]="tag" [loading]=loadingTags loadingText='Loading...'>

                          <ng-template ng-label-tmp let-item="item">
                            <!-- <img height="15" width="15" [src]="item.avatar"/> -->
                            <i [style.color]="item.color" class="fa fa-tag"
                              style="font-size: 18px;position: relative;top: 2px;margin-right: 5px;"></i>

                            {{item.tag}}
                          </ng-template>
                          <ng-template ng-option-tmp let-item="item" let-index="index">
                            <i [style.color]="item.color" class="fa fa-tag"
                              style="font-size: 18px;position: relative;top: 2px;margin-right: 5px;"></i>
                            {{item.tag}}
                          </ng-template>

                        </ng-select>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- </div>
          </div> -->


                <!-- 
          // -----------------------------------------------------------------------------
          // Notes TEST
          // ----------------------------------------------------------------------------- -->
                <div class="card right-card"
                  style="display:none; padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
                  <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;">
                    <!-- BEGIN: Layout-B. -->
                    <div>
                      <textarea [(ngModel)]="new_note" placeholder="{{ 'Notes.AddANote' | translate  }}" rows="2" style="width: 100%;
                  display: block;
                  border: 1px solid #dee2e7;
                  padding: 12px;
                  border-radius: 3px;
                  margin-bottom: 8px;"> </textarea>
                      <button type="button" class="btn btn-primary ws_msgs_small_btn" #cont (click)="addNote()"
                        [disabled]="!new_note || new_note?.length === 0">
                        {{ 'Notes.AddNote' | translate }}
                      </button>
                    </div>
                    <section class="layout layout--b">
                      <div class="layout__top-panel">
                        <div *ngFor="let note of notesArray;" class="content">
                          <p>{{ note?.text }}</p>
                        </div>
                      </div>
                      <!-- <div class="layout__bottom-panel">
                  Using Overscroll-Behavior
                </div> -->
                    </section>
                  </div>
                </div>


                <!-- 
          // -----------------------------------------------------------------------------
          // Notes
          // ----------------------------------------------------------------------------- -->
                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->


                <div class="row" style="">
                  <div class="col-sm-12"
                    style="padding-left: 0px; padding-right: 0px; border-bottom: 1px solid #dadde1;">
                    <p class="row-header accordion" (click)="openNotesAccordion()"
                      style="padding-left:15px; padding-right:15px; font-size: 14px;">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "Notes.Notes" | translate }} ({{ notesArray?.length }})
                      </span>
                    </p>
                    <div class="col-sm-12" style="padding-left: 0px;padding-right: 0px;">


                      <div class="note-container">
                        <div class="note-panel" (scroll)="onScrollx($event)">
                          <div class="ws_msgs_note__textarea">
                            <textarea [(ngModel)]="new_note" placeholder="{{ 'Notes.AddANote' | translate  }}" rows="2"
                              style="width: 100%;
                              display: block;
                              border: 1px solid #dee2e7;
                              padding: 12px;
                              border-radius: 3px;
                              resize: none;
                              margin-bottom: 8px;">

                          </textarea>
                            <button type="button" class="btn btn-xs btn-primary ws_msgs_small_btn" #cont
                              (click)="addNote()" [disabled]="!new_note || new_note?.length === 0">
                              <!-- <i class="material-icons" style="left: -5px;">add_circle</i> -->
                              {{ 'Notes.AddNote' | translate }}

                              <span *ngIf="showSpinnerInAddNoteBtn === true"> <i class="fa fa-spinner fa-spin"
                                  style="font-size: 15px;"></i></span>
                            </button>
                          </div>

                          <div *ngIf="notesArray?.length > 0" class="ws_request_notes__container">

                            <!-- 
                              // ------------------------------------------------------
                              // @ Notes' cards
                              // ------------------------------------------------------ -->
                            <div *ngFor="let note of notesArray;" class="ws_request_note">
                              <div class="ws_request_note__content">
                                {{ note?.text }}
                              </div>
                              <!-- HH:mm:ss -->
                              <div class="ws_request_note__footer">
                                {{ 'Created' | translate}} {{ note.createdAt| date: 'd/M/y'}} {{ 'By' | translate}}
                                {{ note?.createdBy_user?.firstname}} {{ note?.createdBy_user?.lastname}}
                              </div>


                              <!-- 
                              // ------------------------------------------------------
                              // @ Remove note btn (click)="presentModalDeleteNote(note._id)"
                              // ------------------------------------------------------ -->
                              <button *ngIf="currentUserID === note.createdBy " (click)="deleteNote(note._id)"
                                type="button" class="note__delete">
                                <i class="material-icons delete_note_icon" style="font-size:16px">close</i>
                              </button>
                            </div>

                          </div>

                          <!-- <div class="ws_msgs_note__textarea">
                          <textarea [(ngModel)]="new_note" placeholder="{{ 'Notes.AddANote' | translate  }}" rows="2"
                            style="width: 100%;
                              display: block;
                              border: 1px solid #dee2e7;
                              padding: 12px;
                              border-radius: 3px;
                              resize: none;
                              margin-bottom: 8px;">

                          </textarea>
                          <button type="button" class="btn btn-primary ws_msgs_small_btn" #cont (click)="addNote()"
                            [disabled]="!new_note || new_note?.length === 0">
                            {{ 'Notes.AddNote' | translate }}
                          </button>
                        </div> -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- </div>
          </div> -->


                <!-- 
          // -----------------------------------------------------------------------------
          // Requester  !! is not dispalyed (now is displayed as title of the left card)
          // ----------------------------------------------------------------------------- -->
                <div class="card right-card"
                  style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px; display: none;">
                  <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;">

                    <div class="row" style="">
                      <div class="col-sm-12" style="">
                        <p class="row-header" style="">
                          <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                          <span style="vertical-align: middle">
                            {{ "RequestMsgsPage.Requester" | translate }}
                          </span>
                        </p>
                        <!-- style="color:#999999; font-weight: 500" -->
                        <p class="row-body" style="margin-bottom:0px; padding-bottom:0px">

                          <!-- // REQUESTER FULLNAME  -->
                          <span class="requester-avatar-wrapper">
                            <span class="_requester-avatar" [ngStyle]="{'background-color': fillColour }"
                              [ngClass]="{'requester_fullname-undefined' : !request?.lead?.fullname}">
                              <span style="color: #ffffff"> {{ requester_fullname_initial }} </span>
                            </span>
                            <span *ngIf="REQUESTER_IS_VERIFIED === true" class="tooltipx">
                              <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 26.6 26.6"
                                width="17" height="17" style="position: relative;left: -43px;top: -3px;"
                                xml:space="preserve">
                                <style type="text/css">
                                  .st0 {
                                    fill: none;
                                  }

                                  .st1 {
                                    fill: #FFFFFF;
                                  }

                                  .st2 {
                                    fill: #18BDF7;
                                  }
                                </style>
                                <path class="st0" d="M1.3,1.3h24v24h-24V1.3z" />
                                <path class="st1"
                                  d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z" />
                                <path class="st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                                l6.6-6.6l1.4,1.4L11.3,18.3z" />
                              </svg>

                              <span class="tooltiptext"> {{ "VisitorsPage.AuthenticatedUser" | translate }} </span>

                            </span>
                            <div class="requester-status-icon"
                              [ngClass]="{'requester_is_online' : REQUESTER_IS_ONLINE}">
                            </div>

                          </span>

                          <!-- <span style="color:#394f5a;"> {{ "RequestMsgsPage.RequesterName" | translate }}: </span>  -->
                          <span [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}"
                            style="margin-left: 2px;font-size:12px">
                            <!-- {{ requester_fullname }} -->
                            {{request?.lead?.fullname}}
                          </span>
                          <span *ngIf="!request?.lead?.fullname"
                            [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}"
                            style="margin-left: 2px;">
                            n.a.
                          </span>

                          <!-- // VIEW DETAILS BTN -->
                          <span *ngIf="NODEJS_REQUEST_CNTCT_FOUND">
                            <!-- <button class="btn btn-xs btn-white-custom-round pull-right"
                        style="margin-left:8px;margin-top: 4px;" (click)="goToContactDetails()">
                        {{ 'ViewDetails' | translate}}
                      </button> -->


                            <div (click)="goToContactDetails()" class="manage_tags">
                              {{ 'ViewDetails' | translate}}
                            </div>
                          </span>
                        </p>


                        <!-- <p class="row-body" style="margin-top:8px; margin-bottom:0px; padding-bottom:0px">
                    <span style="color:#394f5a;"> {{ "RequestMsgsPage.ChatFormUserName" | translate }}: </span>
                    {{ user_name }}
                  </p> -->

                        <p class="row-body" style="margin-bottom:6px;padding-bottom:0px; margin-top:6px;">

                          <!-- 
                    // ------------------------------------------------------
                    // no more get from request attributes but from lead 
                    // ------------------------------------------------------ -->

                          <!-- <a *ngIf="user_email !== 'n.a.'" href="mailto:{{user_email}}">{{ user_email }}</a>
                     <a *ngIf="user_email === 'n.a.'" style="color:#7695a5;">{{ user_email }}</a> -->

                          <i class="material-icons"
                            style="vertical-align: middle; color: #394f5a;font-size:16px; margin-left: 3px;"> email
                          </i>
                          <span style="position: relative;top: 1px;">
                            <span
                              style="font-size: 12px; color: #394f5a; font-weight: 500;font-family: 'Google Sans', sans-serif !important;">
                              {{ "RequestMsgsPage.ChatFormUserEmail" | translate }}
                            </span>
                            <a target="_blank" *ngIf="request?.lead?.email" href="mailto:{{request?.lead?.email}}">
                              {{request?.lead?.email}}
                            </a>
                            <a *ngIf="!request?.lead?.email" style="color:#7695a5;">n.a.</a>
                          </span>
                        </p>

                        <!-- <p class="row-body" style="margin-bottom:0px; padding-bottom:0px">
                    <span style="color:#394f5a;"> id: </span>
                      {{ requester_id }}
                  </p> -->
                      </div>
                    </div>
                  </div>
                </div>


                <!-- 
          // ------------------------------------------------------
          // DEPARTMENT !! is not dispalyed (now is dispalyed in the first card)
          // ------------------------------------------------------ -->
                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->
                <div class="row" style="display: none;">
                  <div class="col-sm-12" style="">
                    <p class="row-header" style="">
                      <!-- 
                      // ------------------------------------------------------
                      // no more get from request attributes but from DEPARTMENT 
                      // ------------------------------------------------------ -->
                      <!-- {{ department_name }} -->


                      <span style="vertical-align: middle">
                        {{ "RequestMsgsPage.DepartmentName" | translate }}
                      </span>
                    </p>

                    <span class="row-body" style="display: block;">
                      <i class="material-icons"
                        style="vertical-align: middle; color: #394f5a;font-size:16px; margin-left: 3px;">
                        account_balance </i>
                      <!-- <span style="color:#394f5a;"> {{ "DeptsAddEditPage.DeptName" | translate }}: </span> -->

                      <span style="position:relative; top:1px">
                        <span class="ws_requets_msgs__attributes">
                          {{ "Department" | translate }}
                        </span>

                        <span *ngIf="request?.department" style="color: #7695a5; font-weight: 500; font-size: 12px;">
                          {{request?.department?.name}}
                        </span>
                        <span *ngIf="!request?.department"
                          style="color: #7695a5; font-weight: 500; font-size: 12px; text-transform: lowercase;">
                          {{'DepartmentsPage.NoDept' | translate}}
                        </span>
                      </span>
                    </span>
                  </div>
                </div>
                <!-- </div>
          </div> -->


                <!-- 
          // ------------------------------------------------------
          // Rating 
          // ------------------------------------------------------ -->
                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->
                <div class="row" style="">
                  <div class="col-sm-12" style="border-bottom: 1px solid #dadde1;">
                    <p class="row-header" style="">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "RequestMsgsPage.Rating" | translate }}
                      </span>

                      <!-- <span class="fa fa-star checked"></span>
                  <span class="fa fa-star checked"></span>
                  <span class="fa fa-star checked"></span>
                  <span class="fa fa-star"></span>
                  <span class="fa fa-star"></span> -->
                    </p>
                    <!-- <p class="row-body"  style="margin-bottom:0px">  
                        <span style="color:#394f5a;"> {{ "RequestMsgsPage.Rating" | translate }}: </span>
                        {{ rating }}
                    </p> -->

                    <p class="row-body" style="margin-bottom:0px">

                      <span style="color: #7695a5;display: block"> {{ rating }}</span>

                      <span class="ws_requets_msgs__attributes">
                        {{ "RequestMsgsPage.RatingMessage" | translate }}:
                      </span>

                      {{ rating_message }}
                    </p>
                  </div>
                </div>
                <!-- </div>
          </div> -->

                <!-- 
          // ------------------------------------------------------
          // source page !! This is not diaìspayed (now is dispalyed in the first card)
          // ------------------------------------------------------ -->
                <div class="card right-card"
                  style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px; display: none;">
                  <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;">
                    <div class="row" style="">
                      <div class="col-sm-12" style="">
                        <p class="row-header" style="">
                          <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                          <span style="vertical-align: middle">
                            {{ "RequestMsgsPage.SourcePage" | translate }}
                          </span>
                        </p>
                        <p class="row-body" style="margin-bottom:0px; word-wrap: break-word;">

                          <!-- 
                  // ----------------------------------------------------------------
                  // no more get from request attributes but directly from request 
                  // ---------------------------------------------------------------- -->
                          <a href="{{request?.sourcePage}}" target="_blank">{{request?.sourcePage}}</a>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>


                <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px; margin-top: 5px;margin-bottom: 5px;">
            <div class="card-content" style="padding-top: 5px;padding-bottom: 5px;"> -->

                <!-- 
              // ----------------------------------------------------------------
              // @ attributes
              // ---------------------------------------------------------------- -->
                <div *ngIf="request?.attributes" class="row" >
                  <div class="col-sm-12">
                    <p class="row-header">
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle">
                        {{ "Attributes" | translate }}
                      </span>
                    </p>


                    <!-- 
                // ------------------------------------------------------
                // new attributes
                // ------------------------------------------------------ -->
                    <div *ngFor="let attribute of attributesArray; let i = index">
                      <div class="title-attribute" style="margin-bottom: 3px; font-size: 12px">

                        <div class="row">
                          <div class="col-sm-10" style="padding-right: 1px;padding-bottom: 5px;">
                            <div style="float: left; margin-right: 4px;" class="ws_requets_msgs__attributes">
                              {{attribute?.attributeName }}:
                            </div>

                            <div aria-expanded="false" [id]="attribute?.attributeName +'_value'"
                              class="attribute attribute_cutted_text">
                              {{attribute?.attributeValue }}
                            </div>

                          </div>
                          <!-- [id]="attribute?.attributeName +'_arrow_icon'" -->
                          <!-- [ngClass]="{'down' : attributeFullText === true}" -->
                          <!-- white-space: nowrap;width: 1%; -->
                          <div *ngIf="attribute?.attributeValueL + 180 > rightSidebarWidth" class="col-sm-2"
                            style="text-align: right;">
                            <i [id]="attribute?.attributeName +'_arrow_icon'" class="material-icons rotate"
                              style="cursor: pointer; color: #039be5; font-size:18px;"
                              (click)="toggleShowAllString(attribute?.attributeName +'_value', attribute?.attributeName +'_arrow_icon', 'isActive_' + i)">
                              keyboard_arrow_down
                            </i>

                          </div>
                        </div>

                        <!-- 
                    <div class="debug_div">
                      L : {{attribute?.attributeValueL}} <br>
                      L + 180 : {{attribute?.attributeValueL + 180}} <br>
                      SB WIDTH : {{rightSidebarWidth}} 
                    </div> -->

                      </div>
                    </div>
                    <!-- 
                // ------------------------------------------------------
                // ./ end new attributes
                // ------------------------------------------------------ -->

                  </div>
                </div>
              </div>
            </div>
          </div>





          <!-- <div class="card right-card" style="padding-top:5px; padding-bottom:5px;">
            <div *ngIf="showSpinner" class="stretchspinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>
            <h4 class="card-title requestattibutestitle"
              style="text-transform: none; color: #566787; font-weight:400; margin-top: 14px; border-bottom: 1px solid #eeeeee; padding-left: 25px; padding-bottom: 15px;min-height: 43px;">
              <span class="requestattibutes">{{ "RequestMsgsPage.RequestAttributes" | translate }}</span>
            </h4>
            <div class="card-content" style="padding-top:5px;min-height: 556px;">
              <div *ngIf="! showSpinner" class="content-wrap">
              </div>
            </div>
          </div> -->
        </div>
      </div>
    </div>

  </div>
</div>


<!-- 
  // ----------------------------------------------------------------
  // Delete note modal
  // ---------------------------------------------------------------- -->

<!-- <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayModalDeleteNote}"
  style="background-color: rgba(90,90,90,0.9);">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="border-top-left-radius:6px; border-top-right-radius:6px">
      
      <div class="modal-header" style="padding:16px!important; border-bottom:none!important; ">

        <button type="button" class="close" aria-label="Close" (click)="closeModalDeleteNote()"
          style="position: absolute; right: 14px;">
          <span aria-hidden="true">
            <svg class="tide-icon " width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M13.357 11.993l10.256 10.295c0.39 0.391 0.39 1.024 0 1.415-0.194 0.195-0.449 0.292-0.704 0.292s-0.51-0.097-0.705-0.292l-10.257-10.295-10.256 10.295c-0.194 0.195-0.449 0.292-0.704 0.292s-0.51-0.097-0.705-0.292c-0.39-0.391-0.39-1.024 0-1.415l10.256-10.295-10.256-10.294c-0.39-0.391-0.39-1.024 0-1.415s1.020-0.391 1.409 0l10.256 10.294 10.256-10.294c0.39-0.391 1.020-0.391 1.41 0 0.389 0.391 0.389 1.024 0 1.415l-10.256 10.294z">
              </path>
            </svg>
          </span>
        </button>

        <h2 class="modal-title"
          style="color: #f44336; text-align: center; font-family: 'Google Sans', sans-serif !important; margin-top: 20px; font-size:28px">
          <span style="vertical-align: middle;">
            {{ "Notes.DeleteNote" | translate }}
          </span>
        </h2>

      </div>
      <hr class="custom-hr" style="margin-top:3px; margin-bottom:3px">
      <div class="modal-body"
        style="padding-top: 0px; padding-bottom: 0px; padding-right: 34px; padding-left: 34px; line-height: 1">


        <div class="row">
          <div class="col-sm-12">
            <h3 style="text-align: center;  color: #8894ab; font-size: 22px; margin-bottom: 20px">

              {{ "Notes.DoYouReallyWantToCancelTheNote" | translate}}

            </h3>
          </div>
        </div>
      </div>

      <div class="modal-footer"
        style="margin-top: 0px; background-color: #fff; border-top:none; border-bottom-left-radius:6px; border-bottom-right-radius:6px">
        <div style="text-align: center; margin-bottom: 25px;">
          <button class="btn btn-danger" type="button" (click)="deleteNote()">

            {{ "Notes.DeleteNote" | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div> -->

<!-- ------------============= USERS LIST MODAL - FULL WIDTH MODAL =============------------ -->
<div class="modal" tabindex="-1" role="dialog"
  [ngStyle]="{'display': displayUsersListModal , 'height': users_list_modal_height}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-lg users-list-modal" role="document"
    style="width: 100%; height: 100%; margin:0; padding: 0;">
    <div class="modal-content" style="height: auto; min-height: 100%; border-radius: 0; border:none;">

      <div class="modal-header">
        <!-- class="close" -->
        <button type="button" style="border: none !important; float: right" aria-label="Close"
          (click)="closeSelectUsersModal()">
          <span aria-hidden="true" style="font-size:31px; color: rgb(60, 72, 88) !important;">&times;</span>
        </button>

        <h4 class="modal-title">
          <div class="title-wrapper" style="max-width: 936px; margin:auto">
            <span *ngIf="actionInModal === 'reassign'"> {{ "VisitorsPage.ReassignRequest" | translate }} </span>
            <span *ngIf="actionInModal === 'invite'"> {{ "VisitorsPage.AddAgent" | translate }} </span>
          </div>
        </h4>
      </div>

      <div class="modal-body"
        style="padding-right: 15px; padding-top:15px; padding-bottom:15px; max-width: 936px; margin:auto ">

        <div class="row">
          <div class="col-md-12">
            <span *ngIf="actionInModal === 'reassign'">
              <h4 style="font-weight:400">
                {{ "VisitorsPage.SelectTheUserToWhom" | translate }}
              </h4>
            </span>

            <span *ngIf="actionInModal === 'invite'">
              <h4 style="font-weight:400">
                {{ "VisitorsPage.InviteAnotherUserToServe" | translate }}
              </h4>
            </span>
          </div>

          <div class="col-md-12">

            <div class="card" style="margin-top:5px; margin-bottom:5px">

              <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>
              <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive">

                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th colspan="2">
                        <span style="color: #566787">
                          <strong>
                            {{ "UsersPage.User" | translate }}
                          </strong>
                        </span>
                      </th>

                      <th>
                        <span style="color: #566787">
                          <strong>
                            <!-- {{ "UsersPage.Available" | translate }} -->
                            <!-- {{ "AssigneeAgent" | translate }} -->
                            {{ "Assignee" | translate }}
                          </strong>
                        </span>
                      </th>

                      <th>
                        <span style="color: #566787">
                          <strong>
                            <!-- {{ "UsersPage.Role" | translate }} -->
                            {{ "UserRole" | translate }}

                            <!-- <span *ngIf="bots?.length > 0">
                              {{ "BotType" | translate }}
                            </span> -->

                          </strong>
                        </span>
                      </th>

                      <!-- <th>
                        <span style="color: #566787">
                          <strong>
                            Email
                          </strong>
                        </span>
                      </th> -->

                      <th *ngIf="!isMobile"></th>
                    </tr>
                  </thead>
                  <tbody>

                    <!-- 
                    // -----------------------------------------------------------------------------
                    // Project users for
                    // ----------------------------------------------------------------------------- -->
                    <tr *ngFor="let projectUser of projectUsersList;" class="table-row">

                      <td style="width: 25px; cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <img class="ws_requets_msgs__user-img-in-modal"
                          src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{projectUser?.id_user?._id}}%2Fphoto.jpg?alt=media"
                          onerror="this.src='assets/img/no_image_user.png'" />
                        <div class="ws_request_msgs__status-icon"
                          [ngClass]="{'is-user-online' : projectUser?.user_available === true, 'is-user-offline' : projectUser?.user_available === false}">
                        </div>
                      </td>

                      <td style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;">
                          {{ projectUser?.id_user?.firstname }}
                          <span style="text-transform: uppercase">
                            {{ projectUser?.id_user?.lastname }}
                          </span>
                        </p>
                        <span style="color: #7695a5; line-height:18px; font-size:12px">

                          email:
                          <span style="font-weight: 400;"> {{ projectUser?.id_user?.email }} </span>
                        </span>
                      </td>

                      <td style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">

                        <!-- 
                        <div class="checkbox checkbox-no-notallowedcursor" style="">
                          <label>

                            <input [checked]="projectUser?.is_joined_to_request === true" type="checkbox"
                              class="form-check-input" style="width: 16px;height: 16px;" disabled>
                          </label>
                        </div> -->

                        <div *ngIf="projectUser?.is_joined_to_request === true">
                          <i class="material-icons" style="margin-left: 14px;">
                            done
                          </i>
                        </div>

                        <!-- <span *ngIf="projectUser?.user_available === true" style="color: #4caf50; text-transform: capitalize">
                            {{ 'Available' | translate }}
                        </span>
                        <span *ngIf="projectUser?.user_available === false" style="color: #f44336; text-transform: capitalize">
                            {{ 'Unavailable' | translate }}
                        </span> -->
                      </td>

                      <!-- *ngIf="projectUser?.id_user._id !== currentUserID" -->
                      <td style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        {{ projectUser?.role | translate}}
                      </td>

                      <!-- <td>
                        {{ projectUser?.id_user?.email }}
                      </td> -->

                      <!-- projectUser?.id_user._id !== currentUserID && -->
                      <td *ngIf="!isMobile" style="cursor:pointer"
                        (click)="selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <!-- <span class="tooltipx"> -->
                        <div class="assign-request">
                          <!-- <i class="material-icons" style="cursor: pointer">
                            swap_horiz
                          </i> -->
                          <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                            <span *ngIf="actionInModal === 'reassign'">
                              {{ 'VisitorsPage.ReassignTo' | translate}}
                            </span>
                            <span *ngIf="actionInModal === 'invite'">
                              {{ 'VisitorsPage.AssignTo' | translate}}
                            </span>
                          </p>
                          <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                            {{ projectUser?.id_user?.email }}
                          </span>
                        </div>

                        <!-- <span class="tooltiptext">
                            {{ "VisitorsPage.ReassignRequestTo" | translate }} {{ projectUser?.id_user?.email }}
                          </span>
                        </span> -->

                      </td>
                    </tr>

                    <!-- 
                    // -----------------------------------------------------------------------------
                    // Bots for
                    // ----------------------------------------------------------------------------- -->
                    <ng-container *ngIf="actionInModal === 'reassign'">
                      <tr *ngFor="let bot of bots;" class="table-row">

                        <td style="width: 25px; cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">
                          <img class="ws_requets_msgs__user-img-in-modal"
                            src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{bot?._id}}%2Fphoto.jpg?alt=media"
                            onerror="this.src='assets/img/avatar_bot_tiledesk.svg'" />


                          <span *ngIf="bot.type === 'internal'">
                            <img class="ws-request-msgs-bot-type-logo" src="assets/img/tiledesk_logo_no_text.png" />
                          </span>

                          <span *ngIf="bot.type === 'external'">
                            <img class="ws-request-msgs-bot-type-logo" src="assets/img/external_bot_logo.png" />
                          </span>

                          <span *ngIf="bot.type === 'dialogflow'">
                            <img class="ws-request-msgs-bot-type-logo" src="assets/img/Dialogflow_logo_no_text.png" />
                          </span>

                        </td>

                        <td style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">
                          <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;">
                            {{  bot?.name }}
                          </p>
                          <span style="color: #7695a5; line-height:18px; font-size:12px">
                            {{ 'BotType' | translate }}:
                            <span style="text-transform: capitalize;font-weight: 400; ">

                              <span *ngIf="bot.type !== 'internal'">
                                {{ bot?.type }}
                              </span>
                              <span *ngIf="bot.type === 'internal'">

                                native
                              </span>

                            </span>
                          </span>
                        </td>


                        <td style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">

                          <div *ngIf="bot?._id === bot_participant_id">
                            <i class="material-icons" style="margin-left: 14px;">
                              done
                            </i>
                          </div>

                        </td>

                        <td style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">
                          Bot
                        </td>

                        <td *ngIf="!isMobile" style="cursor:pointer" (click)="selectBot(bot?._id, bot?.name)">

                          <div class="assign-request">

                            <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                              <span *ngIf="actionInModal === 'reassign'">
                                {{ 'VisitorsPage.ReassignTo' | translate}}
                              </span>
                              <span *ngIf="actionInModal === 'invite'">
                                {{ 'VisitorsPage.AssignTo' | translate}}
                              </span>
                            </p>
                            <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                              {{ bot?.name }} (bot)
                            </span>
                          </div>
                        </td>
                      </tr>
                    </ng-container>

                  </tbody>
                </table>
              </div>
            </div>
          </div>



          <!-- 
          // ------------------------------------------------------------------------------
          // Reassign to a dept
          // ------------------------------------------------------------------------------ -->
          <section *ngIf="actionInModal === 'reassign' && departments?.length > 1">
            <div class="col-md-12">
              <span>
                <h4 style="font-weight:400">
                  {{ "VisitorsPage.SelectTheDeptsToWhom" | translate }}
                </h4>
              </span>
            </div>
            <div class="col-md-12">

              <div class="card" style="margin-top:5px; margin-bottom:5px">

                <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

                <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive">

                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th colspan="2">
                          <span style="color: #566787">
                            <strong>
                              {{ "Department" | translate }}
                            </strong>
                          </span>
                        </th>

                        <th>
                          <span style="color: #566787">
                            <strong>
                              {{ "Assignee" | translate }}
                            </strong>
                          </span>
                        </th>

                        <th>
                          <span style="color: #566787">
                            <strong>
                              {{ "Agents" | translate }}
                            </strong>
                          </span>
                        </th>



                        <th *ngIf="!isMobile"></th>
                      </tr>
                    </thead>
                    <tbody>

                      <tr *ngFor="let dept of departments;" class="table-row">
                        <ng-container *ngIf="dept.default === false">
                          <td style="width: 25px; cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                          </td>

                          <td style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                            <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;">
                              {{ dept?.name }}

                              <span style="color: #7695a5; font-size: 12px; display: block;">
                                <span style="font-weight:400;">
                                  Routing:
                                </span>
                                {{ dept?.routing }}
                              </span>
                            </p>
                          </td>

                          <td style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                            <!-- <div class="checkbox checkbox-no-notallowedcursor" style="">
                            <label>

                              <input [checked]="request?.department?._id === dept?._id" type="checkbox"
                                class="form-check-input" style="width: 16px;height: 16px;" disabled>
                            </label>
                          </div> -->
                            <div *ngIf="request?.department?._id === dept?._id">
                              <i class="material-icons" style="margin-left: 14px;">
                                done
                              </i>
                            </div>
                          </td>


                          <td style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">
                            <span *ngIf="dept?.hasGroupName && !dept?.groupHasBeenTrashed">

                              <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                {{ 'DepartmentsPage.Group' | translate }}
                              </span>
                              {{ dept?.hasGroupName}}
                            </span>
                            <span *ngIf="dept?.hasGroupName && dept?.groupHasBeenTrashed === true">

                              <span style="vertical-align: middle;"> {{ dept?.hasGroupName }} </span>
                              <i class="material-icons"
                                style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                              <span
                                style="color: #ff5252; vertical-align: middle; font-size:12px;">{{ 'DepartmentsPage.TheGroupHasBeenTrashed' | translate }}
                              </span>
                            </span>

                            <span *ngIf="!dept?.hasGroupName" style="font-size:13px">
                              {{ 'DepartmentsPage.AllUsers' | translate }}
                            </span>

                            <span *ngIf="dept?.id_bot" style="display: block;">
                              <span style="color: #7695a5; font-size: 12px; font-weight:400">
                                Bot {{ 'DepartmentsPage.ActivatedBot' | translate }}
                              </span>

                              <span style="font-size:13px; font-weight:400">
                                {{ dept?.hasBotName }}
                              </span>
                              <span *ngIf="dept.bot_only == true"
                                style="font-size: 12px; color: #7695a5; font-weight: 400">
                                {{ 'DepartmentsPage.OnlyBot' | translate }}
                              </span>
                              <span *ngIf="dept.botHasBeenTrashed == true">
                                <i class="material-icons"
                                  style="vertical-align: middle; font-size:12px; color: #ff5252; padding-left: 8px">report_problem</i>
                                <span
                                  style="color: #ff5252; vertical-align: middle; font-size:12px;">{{ 'BotsPage.TheBotHasBeenTrashed' | translate }}
                                </span>
                              </span>

                            </span>

                          </td>

                          <td *ngIf="!isMobile" style="cursor:pointer" (click)="selectDept(dept?.name, dept?._id)">

                            <div class="assign-request">

                              <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">
                                {{ 'ReassignToDept' | translate}}
                              </p>

                              <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                                {{ dept?.name }}
                              </span>
                            </div>

                          </td>
                        </ng-container>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- ----------------------------- depts ------------------------------------------------- -->

        </div>

      </div> <!-- /. modal-body -->

      <!-- <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseUsersListModalHandler()" style="padding:12px 16px;">
            {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div> -->
    </div> <!-- /.modal-content -->
  </div> <!-- /.modal-dialog -->
</div>

<!-- ============= CONFIRM REQUEST REASSIGNMENT TO USER MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayConfirmReassignmentModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="closeConfirmReassignmentModal()">
          <span aria-hidden="true">&times;</span>
        </button>
        <!-- style="color: #00bcd4" -->
        <h4 class="modal-title" style="color: #00bcd4">
          <i class="material-icons" style="vertical-align: middle">info</i>
          <span style="vertical-align: middle; padding-left:8px">
            <span *ngIf="actionInModal === 'reassign'">
              {{ "VisitorsPage.ReassignRequest" | translate }}
            </span>
            <span *ngIf="actionInModal === 'invite'">
              {{ "VisitorsPage.AddAgent" | translate }}
            </span>
          </span>
        </h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm-10">
            <h4
              style="color: #566787;padding-top: 0px;font-size: 1.1em;font-weight: 500;margin-top: 0px;margin-bottom: 0px;">
              <span *ngIf="actionInModal === 'reassign'">
                {{ "VisitorsPage.TheRequestWillBeReassignedTo" | translate }}
              </span>
              <span *ngIf="actionInModal === 'invite'">
                {{ "VisitorsPage.TheRequestWillBeAssignedTo" | translate }}
              </span>

            </h4>

            <table class="table" style="margin-bottom: 0px;">
              <tbody>
                <tr>
                  <td style=" border-top-width: 0px; width: 25px;">
                    <img *ngIf="userid_selected"
                      src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{userid_selected}}%2Fphoto.jpg?alt=media"
                      width=35 onerror="this.src='assets/img/no_image_user.png'" />
                  </td>
                  <td style=" border-top-width: 0px;">
                    <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;">
                      {{ userfirstname_selected }}
                      <span style="text-transform: uppercase">
                        {{ userlastname_selected }}
                      </span>
                    </p>
                    <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                      {{ useremail_selected }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="closeConfirmReassignmentModal()" style="padding:12px 16px;">
          {{ "VisitorsPage.Cancel" | translate }}
        </button>

        <button *ngIf="actionInModal === 'reassign'" style="margin-top:0px" class="btn btn-primary"
          (click)="reassignRequest(userid_selected)" style="padding:12px 16px;">
          {{ "VisitorsPage.ReassignRequest" | translate }}
        </button>
        <button *ngIf="actionInModal === 'invite'" style="margin-top:0px" class="btn btn-primary"
          (click)="assignRequest(userid_selected)" style="padding:12px 16px;">
          {{ "VisitorsPage.AssignRequest" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ============= CONFIRM REQUEST REASSIGNMENT TO DEPATRMENT MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayDeptConfirmReassignmentModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="closeDeptConfirmReassignmentModal()">
          <span aria-hidden="true">&times;</span>
        </button>
        <!-- style="color: #00bcd4" -->
        <h4 class="modal-title" style="color: #00bcd4">
          <i class="material-icons" style="vertical-align: middle">info</i>
          <span style="vertical-align: middle; padding-left:8px">

            {{ "VisitorsPage.ReassignRequest" | translate }}


          </span>
        </h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm-10">
            <h4
              style="color: #566787;padding-top: 0px;font-size: 1.1em;font-weight: 500;margin-top: 0px;margin-bottom: 0px;">
              <span>
                {{ "VisitorsPage.TheRequestWillBeReassignedTo" | translate }}
              </span>
              <!-- <span *ngIf="actionInModal === 'invite'">
                {{ "VisitorsPage.TheRequestWillBeAssignedTo" | translate }}
              </span> -->

            </h4>

            <table class="table" style="margin-bottom: 0px;">
              <tbody>
                <tr>
                  <td style=" border-top-width: 0px; width: 25px;">
                    <!-- <img *ngIf="userid_selected"
                      src="https://firebasestorage.googleapis.com/v0/b/{{storageBucket}}/o/profiles%2F{{userid_selected}}%2Fphoto.jpg?alt=media"
                      width=35 onerror="this.src='assets/img/no_image_user.png'" /> -->
                  </td>
                  <td style=" border-top-width: 0px;">
                    <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;">
                      {{ deptname_selected }}

                    </p>

                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="closeDeptConfirmReassignmentModal()" style="padding:12px 16px;">
          {{ "VisitorsPage.Cancel" | translate }}
        </button>

        <button style="margin-top:0px" class="btn btn-primary" (click)="reassignRequestToDept(deptid_selected)"
          style="padding:12px 16px;">
          {{ "VisitorsPage.ReassignRequest" | translate }}
        </button>

      </div>
    </div>
  </div>
</div>


<!-- ============= ARCHIVIVE REQUEST MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayArchiveRequestModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- background-color:#ff5252; -->
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="onCloseArchiveRequestModal()">
          <!-- color: #fff -->
          <span aria-hidden="true" style="">&times;</span>
        </button>
        <h4 class="modal-title" style="color: #f44336">
          <i class="material-icons" style="vertical-align: middle">info</i>
          <span style="vertical-align: middle; padding-left:8px">
            <!-- Elimina richiesta -->
            {{ "VisitorsPage.ArchiveRequest" | translate }}
          </span>
        </h4>
        <!-- padding-left: 36px  -->
        <h4 class="modal-title" style="color: #566787; padding-top:10px; font-size: 1.1em; font-weight: 500">
          <!-- La richiesta con ID: <code>{{ id_request_to_delete }}</code> verrà eliminata -->
          {{ "VisitorsPage.TheRequestWithId" | translate }}
          <code style="color: #566787">
            {{ id_request_to_archive }}
          </code>
          {{ "VisitorsPage.WillBeArchived" | translate }}
        </h4>
      </div>
      <div class="modal-body">
        <p style="font-weight:400; text-align: left; margin-top: 10px; color: #566787">
          <!-- Sei sicuro di voler rimuovere la richiesta selezionata? -->
          {{ "VisitorsPage.AreYouSure" | translate }} <br>
          <span style="font-weight:100; color: #999; font-size:12px">
            <em>
              {{ "VisitorsPage.Note" | translate }}
            </em>
          </span>
        </p>

      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="onCloseArchiveRequestModal()" style="padding:12px 16px;">
          <!-- Annulla -->
          {{ "VisitorsPage.Cancel" | translate }}
        </button>
        <button style="margin-top:0px" class="btn btn-danger" (click)="archiveTheRequestHandler()"
          style="padding:12px 16px;">
          <!-- Archivia Richiesta -->
          {{ "VisitorsPage.ArchiveRequest" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ============ INFO MODAL: ARCHIVING REQUEST IN PROGRESS ============ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayArchivingInfoModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="onCloseArchivingInfoModal()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h4 class="modal-title">
          {{ "VisitorsPage.ArchiveRequest" | translate }}
          <!-- <code>{{id_toDelete}}</code> -->
        </h4>
      </div>

      <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">

        <span *ngIf="SHOW_CIRCULAR_SPINNER">
          <div class="loader" style="top:25%;">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>

          </div>
          <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.Processing" | translate }}
          </p>
        </span>

        <span *ngIf="!SHOW_CIRCULAR_SPINNER && !ARCHIVE_REQUEST_ERROR ">

          <div style="text-align: center">
            <i class="material-icons" style="color:#70b665">done</i>
            <p style="color:#70b665; font-weight: 500">
              {{ "VisitorsPage.Completed" | translate }}
            </p>

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.RequestArchived" | translate }}
          </p>
        </span>

        <!-- IF THERE IS AN ERROR -->
        <span *ngIf="!SHOW_CIRCULAR_SPINNER && ARCHIVE_REQUEST_ERROR ">

          <div style="text-align: center ">
            <i class="material-icons" style="color:#ff5252">report_problem</i>
            <p style="color:#ff5252; font-weight: 500">
              {{ "VisitorsPage.Error" | translate }}
            </p>

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.AnErrorHasOccurred" | translate }}
          </p>
        </span>
      </div>

      <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-primary" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseArchivingInfoModal()"
          style="padding:12px 16px;">
          {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div>

    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>

<!-- ============= LEAVE CHAT MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayLeaveChatModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- background-color:#ff5252; -->
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="closeLeaveChatModal()">
          <!-- color: #fff -->
          <span aria-hidden="true" style="">&times;</span>
        </button>
        <h4 class="modal-title" style="color: #f44336">
          <i class="material-icons" style="vertical-align: middle">info</i>
          <span style="vertical-align: middle; padding-left:8px">
            {{ "VisitorsPage.LeaveChat" | translate }}
          </span>
        </h4>
      </div>
      <div class="modal-body">
        <p style="font-weight:400; text-align: left; margin-top: 10px; color: #566787">

          {{ "VisitorsPage.AreYouSureLeftTheChat" | translate }} <br>
        </p>

      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="closeLeaveChatModal()" style="padding:12px 16px;">
          <!-- Annulla -->
          {{ "VisitorsPage.Cancel" | translate }}
        </button>
        <button style="margin-top:0px" class="btn btn-danger" (click)="leaveChat()" style="padding:12px 16px;">
          <!-- Archivia Richiesta -->
          {{ "VisitorsPage.LeaveChat" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ============ INFO MODAL: LEAVING CHAT IN PROGRESS ============ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayLeavingChatInfoModal}"
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="closeLeavingChatInfoModal()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h4 class="modal-title">
          {{ "VisitorsPage.LeaveChat" | translate }}

        </h4>
      </div>

      <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">

        <span *ngIf="SHOW_CIRCULAR_SPINNER">
          <div class="loader" style="top:25%;">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>

          </div>
          <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.Processing" | translate }}
          </p>
        </span>

        <span *ngIf="!SHOW_CIRCULAR_SPINNER && !LEAVE_CHAT_ERROR ">

          <div style="text-align: center">
            <i class="material-icons" style="color:#70b665">done</i>
            <p style="color:#70b665; font-weight: 500">
              {{ "VisitorsPage.Completed" | translate }}
            </p>

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.ChatLeft" | translate }}
          </p>
        </span>

        <!-- IF THERE IS AN ERROR -->
        <span *ngIf="!SHOW_CIRCULAR_SPINNER && LEAVE_CHAT_ERROR">

          <div style="text-align: center ">
            <i class="material-icons" style="color:#ff5252">report_problem</i>
            <p style="color:#ff5252; font-weight: 500">
              {{ "VisitorsPage.Error" | translate }}
            </p>

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "VisitorsPage.AnErrorHasOccurredLeavingTheChat" | translate }}
          </p>
        </span>
      </div>

      <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-primary" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="closeLeavingChatInfoModal()"
          style="padding:12px 16px;">
          {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div>

    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>


<div *ngIf="OPEN_RIGHT_SIDEBAR === true" class="view-side">
  <!-- (valueChange)='closeRightSidebar($event)' -->
  <appdashboard-ws-train-bot [ngStyle]="{'height':train_bot_sidebar_height }" [selectedQuestion]="selectedQuestion"
    (valueChange)='handleCloseRightSidebar($event)'></appdashboard-ws-train-bot>
</div>